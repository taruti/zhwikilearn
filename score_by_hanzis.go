package main

import (
	"log"
	"unicode"

	"github.com/dustin/go-wikiparse"
)

// topHanzi is the top 5000 entries from popularHan
const topHanzi = `的年中日月一人大在是国行國有地小和斯公為第文部名市以上出之作成生主不家子西特星了本台民會政於物球为分南新天德山学方法學道時站克北科他高下路用美其海利里位三代後自拉電及尔区州世外二到多最林被由而加于所表前同與平教王可事十動區立目期理任明金士安全省建女度等基員合港院个考化口賽会者得爾城英演亞列東面通要發巴工因個也影車至長原能时后司次軍尼定阿入共音香比格集力参使系水四重史都布式此界足視性線治太來場卡正空曲心相灣米元體機馬镇戰手品罗但府县社開色華樂亚洲京朝號對长校間隊片江研版田军发運經保李近首制型东五马交縣动現參河古接光神並究起常清委羅業內官员村电夫字车流如与數稱程劇改身或聯季提料角歌意結蘭量進這語向當過將武机石形索福情播連信内總伊無就来關局川展这然白花達男資华对数管選波属曾門設族著普始育洛少开组回直指总獎号体受夏愛龍放已我報島命六單青臺屬经活间级組書八節包圖雷持統吉知视件班座并網各打赛乐商器业種計宗志約級九兩義張團威周现反战帝造种非客廣解联未果线进示塔称湖務更兰运蒙铁鐵說语言收划沙點超陳那類森真场傳置博皇支畫編广議峰些取哈先统图木网过百将今標航奧速專黑伯初希根段兵奇師死只火密實好維达配母队七奥唱献源份植查服友技風去食维街书園像单登勒佳又紀往俱令瓦別野魚頭黃際每牙土引即塞产製氏哥限当故计再堂资迪歷們則變恩景它设修关處案見萬室门擊派從父記甲姆完域老居黨導泰她印千冠莱告该肯該產历央约功深游托康越何遊副排类党嘉除雄投义術洋乡己永纳施半話毛模典易率舉決苏曼两瑞強且題容万亦很宣春编職助錄群聖佛埃推存务张帶失氣館括丁藝應獲卷射警條想实传鎮松唐介納汉郡阳章具据梅攻点飾注親从隆牌帕步姓盟早澳富象报離雙见们認戲輯轉草祖領丹飛增消无備衛求巡兒例漢藏另议说席标思境感艾陸論魔權聲蒂蘇供察紅防变律看歐纪照落倫督創监營陽团沒息堡导住际裝雅术奖整觀萨精韓俄记票素秀选念均才莫升店拿旅寺邦勝籍劉津町屆致仁风左革师菲停库協龙郎应剧岛留興结銀守玉封宮朗黄处领病你護欧积望萊智環弗極許尾谷效弟摩麗喜带快诺授費底宋圣坦尚专項止算承調君良需便續房聞别羽宁還殺附还薩把赫諾杜爭雲追短胡低护簡辖获朱醫藤批鲁橋頓據鄉移終降控节皮久伦寶詞井依葉右油辦卫構切陆昌梁仍陈問旗魯做股船候娜歲论積邊走述微熱破亡气質貝若略吳济假佐夜延役優血宇刘舞黎給眾圍牛职準劃条退抗樓般权贝週岸筑耶距画馆監头核彈槍漫突榜試樣售协頁云园註善构背酒雪值莉送負必戏架认连含較庫惠红奈着秋竹禮敦艦讓規獨翰復屋臣则复匹届争晚爱徐范訊办濟什录沃叶泉桥遠署板似盃繼链庭盛转暴眼秘烏錦序强没傑榮址映判楊决爵荷双爆击端健乘童烈题評敗廷麥兴靈调刊輪隨企末尺溪婚创探准殿柏举獻质溫載證慶洪巨策束顿戶擔裡观救妹装佩狀織兼忠环樹冰態責篇鬥离干響豪鄭规係層綱滿遭坡拔寫珠昭害逝虎项艺拍医澤儿浪差碼庆罪雨頻兄热占請岡卻媒混免仙杰藍营賓測岩备散異材霍芬捷余问啟辛築许声鐘彩戈亲浦农耳棒魏杨妻豐茨胜赤穆刺戴简郭庄乌露费飞酸讀逐預桑样读習池麻给桃瑪边征益拜墓孫顯旋织執沿丽宜寧譯援予私夢崎衣農輕順幕刻韩冬釋话徒宝蔡概亮玩傷楼練舊陵甘難歡廠甚刑廉休终俊凱待评秦哲敏斗識勢坐誌侯價幸毒孝雖温采互符董操款鰭随透码攝独轄劍汽途申证鬼遇孩迷湾跟琴莎急謝培細孔遗詩禁浙按扩续偶御写泽吴银姐孙渡默奏乃午偉絲曹杀吸担犯昆呼众勇乙翼户圈貴菜沈尤皆围徽紐範擁振骨財伍晉採替絕綫卢墨檔固妮翻潮描廳須找佈试极震雜況鮮较招珍儀幻鳥响壓戀驗畢確斷闻熙棋词阅幾紫毫岁祥穿崇充否炸奉继購蝶僅慧某远唯暗层宫激琳危柳瑟乾验圓芳恐輸鏡搜臨几尊柯仔燕逃召齐賢炮彼浩怪赵状嚴騎轨賞鳳綠換葡泊秒陣融厄險捕遷茲载楚宿盧洞歸努宏裁腦昂亨冷養聚勞競晋乎舍玛杯盤幼喬贵缺趙麦脊旧餘迎疑味肉徵满刀補扎輝側敵紹熊銷临辑测邮频潘遺齊敬訓階覺藥泳态滑粉陶返輻胞歧兹谢晶惡績价鱼奪剛偏鹿负慈億靠树仅驻彭凯蓮拼萄桂茶轮葛倒撤翠莊韋灰併跳让欣械况显佔埔零套劳侵杉軟请貨郑諸荣踪駐孟纽阪细叫頂蛋乔析耀審伐丘塘函橫卓頒朋鲜廢韦硬付弘輛笑确芝钟徑压繁顧染迫課弹释礼軌归诗番柱腳凡旁顺饰濱訪輔页舰蓋宅箭講灵掌裕討涉厂談药难衝柴淡奴辽氧堅鼓蛇祭獸裔译疆厅幫责牧识习詹抵仲泛咸曰俗执寬靜覽檢減丰憲菌租圳软殖预避侧滅尖賀借茂娛勤葬鋒阻慕插换锦侍豆瓜盖鄰挑毕亂绝懷聽殊賴妃症断螺錢伴异簽屏恒障跑糖閣冊綜賣倉享隔跨湯绍詳液优尋杂旺涅严凤估拳坑涯姬適启衡答输緒汗廟願舒緣晨隧厚裂吃仰宾夠靖纲崔羊幹败脂屯純岳餐霸寻伸擴魂苦匈呈襲額棲斤杭允滨揮玄玲碑弱鼠宙陷袁疾娃駛漸庙络搭伏忍蛛燃苗冲娘壽句邨翁齒锡检艇媽鋼麼珊琪枝财凌狂摄呂緯菊憶亿吾誠蟲沉幣擎勳颗亭磁顶傅撞辰诸鯉訴币货势困恆坂儒鈴藩療截折鍾寸複拒卿粵患壁誤签坊姊淑薇邀撒伤丸坎貫串斑炎陰翔匯罕迁揚遂朴乳蘋婆拓銅审浮倍拥恢虫柔养貓買擇鄧契獅钱脈销宽壞陕繪熟錫怡叔枪暫拆颱碧訂腹郵譽閱彰蕭筆鯰蓝蔣貢兆怀婦雀冒湘顏狼脫貞叛曆遜麟却遣臘阶轻缩迅圆仪练燈覆巧棄謀戒曉迈錯阵擬竞欲盘姜吕焦夕汪迴鴻獄稿嶼促盡尽驅幅险荒趣宪掉姚丙寿横么俠径讲偵慢喀狗髮枚馮齡雕痛籃剑赴祝扬绿补卜飯廈櫻旦虽汇填访茵貿苑遍腊鑑粒玻砲甸洗孤训獵挥毀阮琉尹梨累紙鸟扮奎隱潭邱刚驚隻坪辭廖針静泥乱躍谋虹虛壇潛圭犬箱狄妖絡寄災贡縮怒欢隸梯緊殘嶺镜逢盾肖辆尉逆废衰须梦夷勁潔丈彥丝卒淘爸循觸勃妙额株肃薛肥凰蕾鷹床袖恋寒毅赞奶伟紋觉損恭览鼻吧减燒陀铜跡艘翡賈岭晴畔閉猪僧蕨贾矿鱸适淮迹券顾矢藉腾衍汝葵疏骑逊购邻蟹栗誕塑駕幽讯堪謂阁鹽薄貌揭盜晓銘帮昇赖鼎既悉冯甜夺够逸窗仇碩隋盐篮誉剂辞脱蜜寨斜牠袭偷汀谈禾胸撰脑塊龜彦隶怖础仿阴嘴综茅钢溶坚垂縱泡郊碟桐譜醒礎邪绕吹笼灭绩吻邓鳴廊霞悲猶閃暨碳毁胎挪棘册沖祐潜割徹帆屈璃塚壘歇脚袋飲庶添嫁斐顆渐戦滾择叉粗彌唇敌吏弦锋贏忘亥汰丑煙旭抱札猛狐炳墙犹譚疗残邁邵涵穩勋籌汤块軒吐听买峽芒讨贊厦恶稻爲轴抽旨煤捐绪蒲愿屠姑奔庚椎剪敢嗣扶淺寮鶴碎冈贸沟损污针鎖砂瀨蹟拟妇淳佑缘伽诉祿稅莲惟灌鍵聰豬舌澄祠脉握襄賊轟舟卑峡搖恰屍肢迦劫銜膜错邑磯辅涌擅措鉴蜂贤巫雞裏乏甫滕奕扁軸笔荃颜怕课磨爺剩厘婷刷沼楠悠漁粹詠闭嫌误坏雍姻灯託硫弓咖礦叙穗霖栽档烟巷違框癌腐紧蜀堆疫斌纸翅藻蒋酷誰豹键芙驱魁凝殼霧蓬岗绘韻坤飓撫麵纯搬繞慎订详姿忙珀潤萧蹤帥矩弄掛謙壮税蹈牆贈耗豫涼衔桓鸡押崖聘蒸竟遵詢壤氯敘駅龄戌兔储宰灾俘虚悟纂酶遞巢儲傾隐辉濃逼喷矛雯盈鄂睡瓶帽丞狱瑜稳坛颁杏堤溝仕鸿灘肇噴坝弃罰娱諡醇肌抓眉岐宛勵祀齿遼穎漠欽稍忽囊喇萍鲍戊逮梵筒礁膠滋礙鮑贺彬斬哪芭郁暖垣诚賜殷憑啦谱耕啡劑搶橘慮拖触崩寅蝠穴喪駿哀淨卸販淵谓纵繩披钦龐猴懸贯梓吋辨臉棕桌搞寓扣朵瓊恨怎鹰暱胶閩玫汶氢寇抚卵毗緬纹栖嫡陪鱗鑽紛猫鯛盆臂猜鴨腺爪裸讷冕棉宴沪伙埼讚掘苯齋帅黛抑腔咒壬緩壯腿蜥矮催卖菩烧壳丛淚踏騰眠耐貼乒旬娅柄堀煌擾秉睿闊僑儘遙蛤禧禦寵吞翌滩牵氨棠惜禪菱吨阜浸硕拱渠瑰埋仓禄萌惑澎悬芸頌朔茜铭棟狙蓉润忆薪扇鯨琼癸胺醉喚腰媛忌乓祈拘噸暂缅庸榴腓贞踢説沛蛙慣涛僕漏纬履誓碰妍愈稀昏賭肅噶烯鞍琦焰湿枢肩挺辣蒼脅违掃婉彻兽哭廚鞋辯壹闽毓冀俞娟瞄咲偽缓鱂廿吊発褐擦惊瘤幌雌畿疊盗磷爬瀏臟裴遲摔傲蜘懿鹤挖鰻昔猎蔚挂孕庇蝴鵬馨哉冥嗎掠鹏瑚瑩紗笛趕漂摘弥狸肺斥削浅赢尿衞募虑欄椅嵐診筹跃罷牽韶呎盲倪赠驾赐肝鸣嘗崗侠秩杆烷倡涂慰樞狮诞囚釜赏嫩怨梭璋稚粤舜鉄駁侶蕃欖扭誘咀胆炭抄綽跋匣攀薦捉矶牲睛饮鱷憂瓷貧瘋菁綾驶笠螢甄鵝掩鮋铺芦橙繫欺喉闆橄遮覧皓夥喝槽鐸騙棍虞謠蘿爐県帖嵌塵鈞逾陝荊捲悅椒勘荆谭凉磅禹叢蘆擺庞窟鎊厭戚埠焚滚励锁彗篤謎寂芽洁摇誼茄遥孚摧哺攜盒糕帳漆塗債逻厥雁矣痕粮喻霆鹃拯頸崙倾閒浴彤递荔雇峻禅娶樑奠壩萱瞬勾欠牟沢橡魅頗巳劣阔嶋賦勸瀬詔狩猿彎蓄氟蝦鳞餅慘瑋屿輩蔷楓瑤溯倩瓣卯柬窮濤窄愉诏彝凶暢净糧罚缸償汕咪禍膽傘跌奸岑丧匪奮庵刃乞湛爽厝贫貪濕歉酋擋栏綁廂僚晃悼兇夸鏈纷莞仑鑫饭韵諮侦辟铸苔懂宵潟牡棚匠竣瀑伪閘伝昊綿芹氮漳曝鬚夾堯燦禎邏黒銳桿櫃戎尸関艙腸窩艷穌虐渔茹澀戸樟曜啊匡曦榆罩駒敷懼嘛蹄琛碱瑛辱釣勿勉卧耿渝簿臀嵩樺憤墜趨赣渦狹厢辩酯询妈籠蒿嬰邸酉悔氫郝酮塌谥霹煩渊糊麒撃鬆畏筋撥砖焉犀娥绥侨彪畜〇瑙扰汐頃徙鑼赋鱈蝙檀轰綺樸滴亩楽趁鍋聊瀛旱汁蕊喊瞳撲薰祺浓抢寡稽拾谦愚幡諺嬌胁樊磐顛躲粘巻饶実麓鑲绵暑呢驛榕鴉鞭冶碘蛺膚孜妥胤鲤粟贴牢楷蕙淀騷淫纤産斋啤瑾総迟浚叱闪諜纖墟渭茱硝気携淇嫻籤殉爛稣々闇瀧豚鍊畑闖胃祁堵梧凍臥谁碍煮暮蠻磊芯姫磡敖尝弼墳溥炒紳滇鋪頜熔黔狭菅篠垃祇霜尧濁侄穷蔭凸冤彙煉凭峯凹臭酰谊赶荐蕉壢妓锐梗迄沁肆鸭罢薯脏墩圾鬧颇钻鹅潰浜鰕黏弧钧戟晏伞煥羚噪邢締厲堰禽岱睦赦苹芷専嘎炫辐妝钩拋哩沂鯊懲匿妾咬巾惹伺夹卦馳惯鄒猩炼剖簧峨膀宦淋芮您炉飄叠岔颖諧幢扫鸦鶯茉熹隼徳陇捨栋桶茎訟颠侏犁棱舅肚胖龟杖诊舖飼鬱谐剌泣蔽俭颶衙劝霄奋妄墅哇铃趋渤貸醜莓迭烤謹酬兜扑舱鎌岬贼裙窑耆瑶沫悦浏孢饒嬪擒蔓佬纏隙恵匙嚇媚穀洙蛾溜劾钓碗泌慾堇歳羌僱糾蘚襪妳隕蟬汾剿仆刪膨惨弊姨趾醬魨偿罐仗庐泗璧毘琅売謊肠樱聪籲苍萼蝕荡轩靂砍箕縫吟肿渣盔咨聂纺瘦阎傻婿敲屢颂鋸倚翊祕酵蚤腕氛眷緝燮繳広债詐竭倭聶暉俯塢鑄骸傭璇擢膛丟釐藓昨钠硅燥莽摆罹寰泄袍衷啓萃羞摸裹閔璐践淹翟鎧裘枫筠痴笨竺査沧擲摺伶賠敕椿斧団闸帜邹焕墮堊湧梳倖撐靴畅懋鸚竊惱埗烹闲斩垒腎蔬歴纜苣膏挽漿諭湊哨瀚苞録弯犧磚塾咤曙蟾墾姦鳚溢辜隅錶諷喙沅錐窦抹褲踐鰓绣皖顷婕祚褒仄罵廁哆昕媳丕肋疼驕芥爷輿尻肪晟崛擠幟濠様荫薹晰脆婴滤诱晤枯証苷昱绳霰葆劲枕綸煞菇玟桜坞绒雛醛虜薔恪饼闵閻蘊辺珂荀删龚搏骚逗愷艳潼緋婭乍匾宠駱鼬槐娄稜渴檐疲濫瀕澜膝釀榄濾呆嗜閥忧炬骏陨扳蚊柚脸歼禺龔撮鉛窝諒歿跆蚌噬棺嶽喆铝煒豊肤傍瞻鏢邯瞭缪誅绑雾渥棣紡旻巩衫羲廓葫舶対蠟芜峙亜恕顱頑磺抬鲸攔肾芋颈繡慌巖骗炯祯腫鈺溃穹舆賺霉锥涡胚崑砌絮皋愁鈕禱寞坠陛鑒訥谍莖菸洽隍珮拨賄丫缝淆綏沐殭紮萝唔铅煜祸鋁憾鮭縛脹贪兀挫脇虔苻蔵忒氰鵰餓灼谕繆驰掀浆綴莆戍泪虏歩髓偕蕩辈愤洩宥攤鳩漲鑰琵鞏奢珉铎挝臻疇闢贖鄞槟浑絶纠泾盼疯侣鉉暹鵡蛮淞檎勛阱鮨瑠穂鄺釘吵泵糟卉飽臧檬惧柿赔臼溴貶嘯嬅尘吁莒贷烃蟻晖厉顎谣僖鷲辻笃唤趟苓鰍沸盎捧詮锅吡糙嘲夭靶悚吗抛枣癒鰨鬍贿鹼繹淄壺帛嘆沽鈔驳廬戮驟変淪阀恺咏潑茛鵑鰈苇剥鉤遁骆灶経豎衢酿殲薨柑侗渾緻諫揆剝筱竜溺魄蚀艮莹溉荻糸埕琶翎悍寛桔僵謬傀庾嫂睹翹魮僻闘冉儡篷钾拐俾掣蒜鲨酪鷺膳抒谨俏竇昶朽峪図橢佟骼褚乗妒竿笙昧渚鞘菀誦鈍敞瑄衆詛楞増棵陌汞皂恥醋靚苟撕憩煎氹讽牺鷗栃俐濂帐剎蕴贬嘻羟焊舵頤跤篡吼悪璽瞿奚譴轎妤佚斃稷滙叡忻婁讼妨喃璞捍憐瀾滬裳酚槃稔毋釧硼蜗呀埤虧挡杞萩撑寝稠滄璟祂僉畴饥屡猷樽冼嫔矽缔笹盪啸滯秤蠍惩雉窪湄烂讫氓迺卤佣鹹泓蔗怜訶胀吒堺虾槳誇莺刹胥飘鉅丢絨蓓諱甯壟駝郷赌逍缴鳅陞佘桢绅厌钙檳靳琮侖莘狠踩屑靡饱漕朕甥镶崁珪贩圻冻沾撼琥咽俸谜侃灿甬豔毎葱眺甦闹艱砸蚜凜絵瀋椰枋郸慨黜飆姉叮腥艰胰剃恤絆続厨儂孵绰坟濮転陂乖蔥账柵扯濬煽祉璜缀鹛碁涨刁烦梶淦檗岚驼窃鎬謚灑昵剣钊贛靼鱇賃悄燊巽懶鮟祷閏燭仮沮妲醚羈娇颐阐锤鞠谟谴曇宸楨豁拂跪駭妆夔鱨蓼泸圃弈蠅満円喵馥耍毯楔钰譬肽诛竖麾賤銓貳闕膺拷瘟峭飢姪糯篆驿祜挤恬兌謨陡檸椭獣滲攸瞞擂卅瞰蜡俺倆浣沌玖纱聆貂澍覓寢羨吠潍煦刮鍛蜴烽嫉菈綬滥闡斡脩傣蜢匝钥伎熾樵緹錘躁鴿壶櫛軀堃儉隘檜栓骤杠侮咎薑暈卞鏗啄婢蛟墊洼螂锌绸叹孽濒煲梟掖汲筲敛鐮蒐脾蚁酱莪俳鳍陋憎垦鮃抨巍蝽蝇劭渲歪暐泼鈣唸矯钞鮠蚕垫咕滔瀝绎孺噹毆詭蟒霏匀槓阙愧浊桦挾簇羧顔襟扔锂鹦偃諦烘柜険歆槻霊叻諏雳弁轅鈉滞窯稲鈎兮奘弋殆畸麴舷褶崧邕羯擱汴藜萎妞饑绶侬宕苛昼闯岷曳谏饲虢炜诵昴蝸琰鲷焯汙馴叭癡潞珈弩籽昀氦畠缆垄訣逵畝劈蔑砷蓟軼垮渗眶葦攬擄镑袜缉悖啶榛齦冢闰鲈隴樋鄱屎帘栅観澈鸽頰蠕豈圩诈倦屁疹肛鮫缮丐絢扈拦杵禿鑾哮洵棧斛侑誣悶玮琢淩榔爹饿毙煊覃襯蝨釗轿銃酥纶瑕読秃碉奄螯洮峇蝉骷両槭蝎込灝茫嫦幂栄淤沦脷蠶漩撈鮡晦収兑鼩烨坳溧栢濑蝗捆殯勻蜱郴镍壕堕姍喘齣涪贻兖蠢撿鎚晝簾絹唑撇锯喰粥霑铨拙拌鋰潢琨弾鈾抜侈炱戛蒨沱涙嬴皿桅鄙嫣蜓餉邰嬉玺愍閑鸠檻荚硒眞旌滸榎絃骂窺讳霓舎涿営钮艋鑿赎薫甩棻薙骄蛭舺燁匆缠钉栈槌捜佰箴骰胱霈樁浒赓檄笈権灸瓚紘趴荠耦癖躺佗滘熄琬铉澡蜻坍晒嬤釉韬煇砵梢骥鯡馀歙幪児蔻铀凿遏韌躬鯽荧颍憧刈傢凪瀉捏湃螃碇钝蔔癮笋櫚娣箏吓韜榊滝殴庁唄麝囑乂`

type ScoreByHanziConfig struct {
	Known      int
	Learning   int
	MaxUnknown int
}

func NewScoreByHanzis(sc ScoreByHanziConfig) *scorePageByHanzis {
	m := map[rune]float64{}
	i := 0
	for _, codepoint := range topHanzi {
		if i >= sc.Known+sc.Learning {
			break
		}
		score := 0.0
		if i >= sc.Known {
			score = float64(i-sc.Known) / float64(1+sc.Learning)
		}
		m[codepoint] = score
		i++
	}
	return &scorePageByHanzis{m, sc.MaxUnknown}
}

type scorePageByHanzis struct {
	runeCost   map[rune]float64
	maxUnknown int
}

func (sh *scorePageByHanzis) Process(page *wikiparse.Page) error {
	unknown := 0
	total := 0
	cost := 0.0
	for _, codepoint := range page.Revisions[0].Text {
		if codepoint < 0x80 || !unicode.Is(unicode.Han, codepoint) {
			continue
		}
		total++
		tcost, found := sh.runeCost[codepoint]
		if !found {
			unknown++
			if unknown > sh.maxUnknown {
				return nil
			}
			tcost = 1.0
		}
		cost += tcost
	}
	score := float64(total) / cost
	log.Printf("%.2f SPBH \"%s\" \ttotal=%d unknown=%d cost=%.2f score=%.2f",
		100*score,
		page.Title, total, unknown, cost, score)
	return nil
}
